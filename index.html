<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Flashcard Nh·∫≠t ‚Äì Created by ƒêen Khui</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#ffe0f5,#ffd6f0);margin:0;padding:0;color:#333;}
        h1{text-align:center;color:#ff97df;font-size:46px;margin:40px 0 10px;text-shadow:0 0 8px white,0 0 15px #ffb7ef,0 0 30px #ff7bda;font-weight:700;}
        .container{width:92%;max-width:1000px;margin:0 auto 40px;}
        .box{background:rgba(255,245,252,0.95);padding:16px;border-radius:12px;box-shadow:0 0 15px rgba(255,150,230,0.35);margin-bottom:16px;}
        textarea{width:100%;padding:10px;margin:8px 0 12px;border-radius:10px;border:2px solid #ffa6e9;box-sizing:border-box;font-size:16px;resize:vertical;min-height:120px;}
        button{padding:10px 16px;border:none;background:#ff7ed8;color:#fff;font-size:15px;font-weight:600;border-radius:10px;cursor:pointer;box-shadow:0 0 8px #ffb3ef;margin:6px 8px 6px 0;}
        button:hover{background:#ff58c5;}
        .card{width:100%;height:260px;margin-top:12px;perspective:1200px;}
        .inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:0.5s;}
        .flipped{transform:rotateY(180deg);}
        .side{width:100%;height:100%;position:absolute;backface-visibility:hidden;display:flex;justify-content:center;align-items:center;font-size:63px;font-weight:700;color:#4b0036;background:rgba(255,239,250,0.85);border:2px solid #ffa6e9;border-radius:18px;padding:12px;box-sizing:border-box;text-align:center;}
        .back{transform:rotateY(180deg);}
        .center{text-align:center;margin-top:14px;}
        .signature{text-align:center;margin:30px 0 20px;font-size:15px;color:#ff7ed8;font-weight:700;}

        /* N√∫t B√†i h·ªçc g√≥c tr√™n ph·∫£i */
        #lessonBtn{position:fixed;top:15px;right:15px;background:#ff6b9d;color:#fff;padding:11px 24px;border-radius:50px;font-weight:bold;cursor:pointer;box-shadow:0 5px 20px rgba(0,0,0,0.3);z-index:9999;font-size:17px;transition:.3s;}
        #lessonBtn:hover{transform:scale(1.12);background:#ff477e;}
        .lesson-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:9998;justify-content:center;align-items:center;}
        .lesson-content{background:#fff;border-radius:20px;width:90%;max-width:480px;padding:20px;max-height:85vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.5);}
        .lesson-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
        .add-deck-btn{width:100%;padding:15px;background:#ff9ac1;color:#fff;border:none;border-radius:50px;font-size:17px;margin:10px 0;cursor:pointer;}
        .deck-item{background:#fff1f8;padding:16px;margin:8px 0;border-radius:15px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
        .deck-item.current{background:#ff6b9d;color:#fff;}
        .deck-item button{background:none;border:none;cursor:pointer;font-size:15px;padding:6px 8px;border-radius:8px;}
        .deck-item .small{font-size:13px;color:#6b2a4a;margin-left:8px;}
        .hidden{display:none;}
        /* sakura z-index low */
        .sakura-petal{position:fixed;top:-50px;left:0;width:24px;height:24px;background:radial-gradient(circle at 30% 30%,#ffb7e5,#ff9edf);border-radius:50% 50% 50% 0;transform:rotate(-30deg);box-shadow:0 0 12px #fff;pointer-events:none;z-index:2;opacity:0.9;}
    </style>
</head>
<body>

<!-- N√öT B√ÄI H·ªåC -->
<div id="lessonBtn">B√†i</div>

<!-- MODAL QU·∫¢N L√ù B·ªò B√ÄI -->
<div id="lessonModal" class="lesson-modal" aria-hidden="true">
  <div class="lesson-content">
    <div class="lesson-header">
      <h3>Danh s√°ch b·ªô b√†i</h3>
      <span onclick="closeLesson()" style="cursor:pointer;font-size:28px;font-weight:bold;">√ó</span>
    </div>
    <button class="add-deck-btn" onclick="createNewDeck()">+ T·∫°o b·ªô m·ªõi</button>
    <div id="deckList"></div>
  </div>
</div>

<h1>üå∏Flashcard 5.0üå∏</h1>

<div class="container">
  <!-- IMPORT & CONTROLS: lu√¥n hi·ªÉn th·ªã (theo y√™u c·∫ßu) -->
  <div class="box">
    <h3 style="margin:0 0 8px;">Import t·ª´ v·ª±ng v√¥ ƒë√¢yyyyyy</h3>
    <textarea id="pasteFromWord" placeholder="Áä¨ - con ch√≥&#10;Áå´ - con m√®o"></textarea>
    <div style="display:flex;flex-wrap:wrap;align-items:center;">
      <button onclick="bulkAddFromPaste()">Xu·∫•t th·∫ª t·ª´ v·ª±ng üçïüçùüçôüç•üç±üç£üç©üçî</button>
      <button onclick="clearCurrentLesson()">X√≥a to√†n b·ªô b√†i n√†y</button>
      <button onclick="shuffleLesson()">Tr·ªôn to√†n b·ªô th·∫ª</button>
      <button onclick="prevCard()">Th·∫ª tr∆∞·ªõc</button>
      <button onclick="nextCard()">Th·∫ª sau</button>
      <button onclick="deleteCard()">X√≥a th·∫ª hi·ªán t·∫°i</button>
      <div style="margin-left:auto;font-size:16px;color:#6b2a4a;">
        B·ªô hi·ªán t·∫°i: <strong><span id="currentDeckName">‚Äî Ch∆∞a ch·ªçn ‚Äî</span></strong>
      </div>
    </div>
    <div style="margin-top:8px;font-size:13px;color:#6b2a4a;">
      L∆∞u √Ω: T·∫°o ho·∫∑c ch·ªçn b·ªô b√†i b·∫±ng n√∫t <strong>B√†i</strong> (g√≥c tr√™n ph·∫£i) tr∆∞·ªõc khi th√™m t·ª´.
    </div>
  </div>

  <!-- Ph·∫ßn th√¥ng tin s·ªë th·∫ª (lu√¥n hi·ªán) -->
  <div class="box center">
    <div style="margin-top:6px;font-size:18px;">
      Th·∫ª: <span id="cardNum">0</span>/<span id="cardTotal">0</span>
    </div>
  </div>

  <!-- FLASHCARD: ·∫©n khi ch∆∞a ch·ªçn b·ªô -->
  <div id="cardArea" class="card hidden" aria-hidden="true">
    <div id="cardInner" class="inner" onclick="flipCard()">
      <div class="side front" id="frontCard">Ch∆∞a c√≥ th·∫ª</div>
      <div class="side back" id="backCard">‚Äî</div>
    </div>
  </div>

</div>

<div class="signature">Created by PHAM DANG KHOI</div>

<script>
// ==================== C·∫§U H√åNH + STORAGE ====================
const DECK_KEY = 'denkhui_decks_2025';
let allDecks = JSON.parse(localStorage.getItem(DECK_KEY) || '[]');
let currentDeckName = localStorage.getItem('denkhui_current_deck') || null;

if (!Array.isArray(allDecks)) allDecks = [];

// N·∫øu user ch∆∞a c√≥ b·ªô n√†o, kh√¥ng t·ª± sinh "M·∫∑c ƒë·ªãnh" ·ªü l·∫ßn m·ªü ƒë·∫ßu ‚Äî theo y√™u c·∫ßu: kh√¥ng c√≥ s·∫µn flashcard
// Tuy nhi√™n n·∫øu mu·ªën gi·ªØ 1 b·ªô m·∫∑c ƒë·ªãnh sau n√†y, user c√≥ th·ªÉ t·∫°o qua n√∫t "B√†i"

// ==================== FLASHCARD CORE ====================
let currentCards = [];   // th·∫ª c·ªßa b·ªô hi·ªán t·∫°i
let currentIndex = 0;

function refreshDisplay() {
  document.getElementById("cardTotal").textContent = currentCards.length;
  document.getElementById("cardNum").textContent = currentCards.length ? currentIndex + 1 : 0;
  if (currentCards.length > 0) {
    document.getElementById("frontCard").textContent = currentCards[currentIndex].front;
    document.getElementById("backCard").textContent = currentCards[currentIndex].back;
  } else {
    document.getElementById("frontCard").textContent = "Kh√¥ng c√≥ th·∫ª n√†o";
    document.getElementById("backCard").textContent = "‚Äî";
  }
  document.getElementById("cardInner").classList.remove("flipped");
}

function flipCard() { 
  const inner = document.getElementById("cardInner");
  inner.classList.toggle("flipped");
}
function nextCard() { 
  if(currentCards.length){
    currentIndex=(currentIndex+1)%currentCards.length; 
    refreshDisplay(); 
  }
}
function prevCard() { 
  if(currentCards.length){
    currentIndex=(currentIndex-1+currentCards.length)%currentCards.length; 
    refreshDisplay(); 
  }
}
function deleteCard() {
  if(!currentCards.length) return;
  if(!confirm("X√≥a th·∫ª n√†y?")) return;
  currentCards.splice(currentIndex,1);
  if(currentIndex >= currentCards.length && currentCards.length) currentIndex = currentCards.length-1;
  saveCurrentDeck();
  refreshDisplay();
}
function clearCurrentLesson() {
  if(!currentDeckName) { alert("Ch∆∞a ch·ªçn b·ªô n√†o. Vui l√≤ng t·∫°o ho·∫∑c ch·ªçn b·ªô b·∫±ng n√∫t 'B√†i'"); return; }
  if(!confirm("X√≥a to√†n b·ªô th·∫ª trong b·ªô n√†y?")) return;
  currentCards = [];
  currentIndex = 0;
  saveCurrentDeck();
  refreshDisplay();
}
function bulkAddFromPaste() {
  const text = document.getElementById("pasteFromWord").value.trim();
  if(!text) return alert("D√°n t·ª´ v·ª±ng v√†o √¥ tr∆∞·ªõc!");
  if(!currentDeckName) {
    return alert("Vui l√≤ng t·∫°o ho·∫∑c ch·ªçn b·ªô tr∆∞·ªõc khi th√™m t·ª´ (nh·∫•n n√∫t 'B√†i' ·ªü g√≥c tr√™n).");
  }
  const lines = text.split('\n').map(s=>s.trim()).filter(Boolean);
  let added = 0;
  lines.forEach(l => {
    // format: front - back  (accept various dash types)
    const m = l.match(/^(.+?)\s*[-‚Äì‚Äî]\s*(.+)$/);
    if(m){
      currentCards.push({front:m[1].trim(), back:m[2].trim()});
      added++;
    }
  });
  if(added){
    saveCurrentDeck();
    refreshDisplay();
    alert(`ƒê√£ th√™m ${added} th·∫ª v√†o b·ªô "${currentDeckName}"`);
    document.getElementById("pasteFromWord").value = "";
  } else {
    alert("Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c ƒë·ªãnh d·∫°ng n√†o (d√πng: t·ª´ - nghƒ©a)");
  }
}

function saveCurrentDeck() {
  if(!currentDeckName) return;
  const deck = allDecks.find(d => d.name === currentDeckName);
  if(deck) deck.cards = currentCards;
  localStorage.setItem(DECK_KEY, JSON.stringify(allDecks));
}

// ==================== MODAL B√ÄI H·ªåC ====================
const lessonBtn = document.getElementById("lessonBtn");
const lessonModal = document.getElementById("lessonModal");
lessonBtn.addEventListener('click', () => {
  renderDeckList();
  lessonModal.style.display = "flex";
  lessonModal.setAttribute('aria-hidden', 'false');
});
function closeLesson() { 
  lessonModal.style.display = "none"; 
  lessonModal.setAttribute('aria-hidden', 'true');
}

function renderDeckList() {
  const list = document.getElementById("deckList");
  list.innerHTML = "";
  if(allDecks.length === 0){
    const hint = document.createElement('div');
    hint.style.padding = '12px';
    hint.style.color = '#6b2a4a';
    hint.textContent = "Ch∆∞a c√≥ b·ªô n√†o ‚Äî b·∫•m 'T·∫°o b·ªô m·ªõi' ƒë·ªÉ b·∫Øt ƒë·∫ßu.";
    list.appendChild(hint);
    return;
  }
  allDecks.forEach(d => {
    const el = document.createElement("div");
    el.className = "deck-item" + (d.name===currentDeckName ? " current" : "");
    const left = document.createElement('div');
    left.innerHTML = `<strong>${escapeHtml(d.name)}</strong> <span class="small">(${(d.cards||[]).length} th·∫ª)</span>`;
    const right = document.createElement('div');

    // Edit button
    const btnEdit = document.createElement('button');
    btnEdit.title = "ƒê·ªïi t√™n";
    btnEdit.innerHTML = "‚úé";
    btnEdit.onclick = () => renameDeck(d.name);

    // Delete button
    const btnDel = document.createElement('button');
    btnDel.title = "X√≥a b·ªô";
    btnDel.style.color = '#ff4757';
    btnDel.innerHTML = "üóë";
    btnDel.onclick = () => deleteDeck(d.name);

    // Select button
    const btnSelect = document.createElement('button');
    btnSelect.title = "Ch·ªçn b·ªô";
    btnSelect.style.color = '#ff6b9d';
    btnSelect.innerHTML = "Ch·ªçn";
    btnSelect.onclick = () => { selectDeck(d.name); };

    right.appendChild(btnEdit);
    right.appendChild(btnDel);
    right.appendChild(btnSelect);

    el.appendChild(left);
    el.appendChild(right);
    list.appendChild(el);
  });
}

function createNewDeck() {
  let n = prompt("T√™n b·ªô m·ªõi (VD: B√†i 45, N5 T·ª´ v·ª±ng):");
  if(!n) return;
  n = n.trim();
  if(allDecks.some(d=>d.name===n)) return alert("T√™n ƒë√£ t·ªìn t·∫°i!");
  const newDeck = {name:n, cards:[]};
  allDecks.push(newDeck);
  localStorage.setItem(DECK_KEY, JSON.stringify(allDecks));
  renderDeckList();
  // auto-select the new deck
  selectDeck(n);
}

function selectDeck(name) {
  currentDeckName = name;
  localStorage.setItem('denkhui_current_deck', name);
  const deck = allDecks.find(d=>d.name===name);
  currentCards = deck && Array.isArray(deck.cards) ? deck.cards.slice() : [];
  currentIndex = 0;
  document.getElementById("currentDeckName").textContent = name;
  // show card area now
  document.getElementById("cardArea").classList.remove('hidden');
  document.getElementById("cardArea").removeAttribute('aria-hidden');
  refreshDisplay();
  closeLesson();
}

function renameDeck(old) {
  let n = prompt("ƒê·ªïi t√™n th√†nh:", old);
  if(!n) return;
  n = n.trim();
  if(n === old) return;
  if(allDecks.some(d=>d.name===n)) return alert("T√™n ƒë√£ t·ªìn t·∫°i!");
  const deck = allDecks.find(d=>d.name===old);
  if(!deck) return;
  deck.name = n;
  if(currentDeckName === old){
    currentDeckName = n;
    localStorage.setItem('denkhui_current_deck', n);
    document.getElementById("currentDeckName").textContent = n;
  }
  localStorage.setItem(DECK_KEY, JSON.stringify(allDecks));
  renderDeckList();
}

function deleteDeck(name) {
  if(!confirm(`X√≥a b·ªô "${name}"? To√†n b·ªô th·∫ª s·∫Ω m·∫•t!`)) return;
  allDecks = allDecks.filter(d=>d.name!==name);
  localStorage.setItem(DECK_KEY, JSON.stringify(allDecks));
  if(currentDeckName===name){
    currentDeckName = null;
    currentCards = [];
    currentIndex = 0;
    document.getElementById("cardArea").classList.add('hidden');
    document.getElementById("cardArea").setAttribute('aria-hidden', 'true');
    document.getElementById("currentDeckName").textContent = "‚Äî Ch∆∞a ch·ªçn ‚Äî";
    localStorage.removeItem('denkhui_current_deck');
  }
  renderDeckList();
}

// Khi m·ªü trang l·∫ßn ƒë·∫ßu: n·∫øu ƒë√£ c√≥ b·ªô ƒë∆∞·ª£c l∆∞u v√† t·ªìn t·∫°i, gi·ªØ l·∫°i selection; n·∫øu kh√¥ng, ƒë·ªÉ tr·ªëng
window.addEventListener('load', () => {
  if(currentDeckName){
    const deck = allDecks.find(d=>d.name===currentDeckName);
    if(deck){
      currentCards = Array.isArray(deck.cards) ? deck.cards.slice() : [];
      document.getElementById("currentDeckName").textContent = currentDeckName;
      document.getElementById("cardArea").classList.remove('hidden');
      document.getElementById("cardArea").removeAttribute('aria-hidden');
      refreshDisplay();
    } else {
      // stored name kh√¥ng c√≤n trong allDecks -> clear
      currentDeckName = null;
      localStorage.removeItem('denkhui_current_deck');
    }
  }
});

// ==================== HOA ANH ƒê√ÄO (Sakura) ====================
(function startSakura(){
  // th√™m keyframes style
  const style = document.createElement("style");
  style.textContent = `@keyframes sakuraFall{
    0%{transform:translateY(-100vh) rotate(0deg) translateX(0);opacity:0;}
    10%{opacity:1;}
    100%{transform:translateY(110vh) rotate(720deg) translateX(100px);opacity:0;}
  }`;
  document.head.appendChild(style);

  setInterval(() => {
    const p = document.createElement("div");
    p.className = 'sakura-petal';
    const left = Math.random()*100;
    const duration = Math.random()*12+12;
    const opacity = Math.random()*0.4+0.6;
    p.style.left = `${left}vw`;
    p.style.width = `${Math.random()*18+16}px`;
    p.style.height = p.style.width;
    p.style.opacity = opacity;
    p.style.zIndex = 2;
    p.style.animation = `sakuraFall ${duration}s linear forwards`;
    document.body.appendChild(p);
    setTimeout(() => {
      try{ p.remove(); }catch(e){}
    }, (duration+1)*1000);
  }, 300);
})();

// ==================== H·ªñ TR·ª¢ NH·ªé ====================
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, function(m) {
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
  });
}

// END
// --- ƒêi·ªÅu khi·ªÉn flashcard b·∫±ng ph√≠m m≈©i t√™n ---
document.addEventListener("keydown", function (e) {
    if (e.key === "ArrowRight") {
        showNextCard(); // chuy·ªÉn th·∫ª ti·∫øp theo
    }
});
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowRight') nextCard();
    if (e.key === 'ArrowLeft') prevCard();
    if (e.key === 'ArrowUp') prevLesson();
    if (e.key === 'ArrowDown') nextLesson();
});
// H√†m tr·ªôn b√†i ‚Äì th√™m v√†o ƒë·ªÉ c√≥ n√∫t "Tr·ªôn to√†n b·ªô th·∫ª"
function shuffleLesson() {
    if (!currentCards || currentCards.length <= 1) {
        alert("Kh√¥ng ƒë·ªß th·∫ª ƒë·ªÉ tr·ªôn!");
        return;
    }
    // Fisher-Yates shuffle ‚Äì chu·∫©n x√°c, ng·∫´u nhi√™n ho√†n to√†n
    for (let i = currentCards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        const temp = currentCards[i];
        currentCards[i] = currentCards[j];
        currentCards[j] = temp;
    }
    currentIndex = 0; // quay v·ªÅ th·∫ª ƒë·∫ßu sau khi tr·ªôn
    saveCurrentDeck();
    refreshDisplay();
    alert("ƒê√£ tr·ªôn ng·∫´u nhi√™n to√†n b·ªô th·∫ª trong b·ªô!");
}
</script>
</body>
</html>
